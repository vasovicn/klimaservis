(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,12133,e=>{"use strict";e.s(["SERVICES",0,[{id:"mali",name:"Mali servis",price:"4.000",priceValue:4e3,duration:30,description:"Osnovno čišćenje i provera klima uređaja",features:["Čišćenje filtera","Provera nivoa freona","Dezinfekcija unutrašnje jedinice","Vizuelna kontrola sistema"]},{id:"veliki",name:"Veliki servis",price:"7.000",priceValue:7e3,duration:60,description:"Kompletno čišćenje i održavanje klima uređaja",features:["Kompletno čišćenje unutrašnje jedinice","Čišćenje spoljašnje jedinice","Dopuna freona","Dezinfekcija i antibakterijski tretman","Provera svih komponenti"]},{id:"kondenzator",name:"Zamena kondenzatora",price:"5.000",priceValue:5e3,duration:45,description:"Dijagnostika i zamena kondenzatora",features:["Dijagnostika kvara","Zamena kondenzatora","Testiranje sistema","Garancija na rad"]}]])},12172,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(12133);function r({onClose:e,onCreated:r,prefillServiserId:n,prefillDate:l,prefillTime:i}){let[d,o]=(0,a.useState)([]),[c,m]=(0,a.useState)([]),[u,x]=(0,a.useState)(l||""),[g,b]=(0,a.useState)(i||""),[h,p]=(0,a.useState)(""),[j,f]=(0,a.useState)(""),[y,v]=(0,a.useState)(""),[N,k]=(0,a.useState)(n||""),[w,S]=(0,a.useState)(30),[C,D]=(0,a.useState)(!1),[T,z]=(0,a.useState)(""),$=c.includes("ostalo");(0,a.useEffect)(()=>{fetch("/api/admin/users").then(e=>e.json()).then(e=>{let t=(e.users||[]).filter(e=>"serviser"===e.role&&!1!==e.active);o(t),!N&&t.length>0&&k(t[0].id)})},[N]);let M=e=>{m(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},O=async e=>{e.preventDefault(),D(!0),z("");try{let e=await fetch("/api/admin/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({services:c,date:u,startTime:g,customerName:h,customerPhone:j,customerAddress:y,userId:N,...$?{customDuration:w}:{}})});if(!e.ok){let t=await e.json();z(t.error||"Greška");return}r()}catch{z("Greška pri povezivanju")}finally{D(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-xl",children:[(0,t.jsx)("h3",{className:"mb-4 text-lg font-bold text-gray-900",children:"Novo zakazivanje"}),(0,t.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Usluge"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[s.SERVICES.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>M(e.id),className:`rounded-full px-3 py-1 text-sm font-medium transition-colors ${c.includes(e.id)?"bg-brand-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:e.name},e.id)),(0,t.jsx)("button",{type:"button",onClick:()=>M("ostalo"),className:`rounded-full px-3 py-1 text-sm font-medium transition-colors ${$?"bg-brand-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Ostalo"})]})]}),$&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Trajanje (minuti)"}),(0,t.jsx)("input",{type:"number",value:w,onChange:e=>S(Number(e.target.value)),min:15,step:15,required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Datum"}),(0,t.jsx)("input",{type:"date",value:u,onChange:e=>x(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Vreme"}),(0,t.jsx)("input",{type:"time",value:g,onChange:e=>b(e.target.value),step:"1800",required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Serviser"}),(0,t.jsx)("select",{value:N,onChange:e=>k(e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500",children:d.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Ime i prezime"}),(0,t.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Telefon"}),(0,t.jsx)("input",{type:"tel",value:j,onChange:e=>f(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Adresa"}),(0,t.jsx)("input",{type:"text",value:y,onChange:e=>v(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]}),T&&(0,t.jsx)("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-600",children:T}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"submit",disabled:C||0===c.length,className:"flex-1 rounded-lg bg-brand-500 py-2.5 text-sm font-semibold text-white hover:bg-brand-600 disabled:bg-gray-300",children:C?"Čuvanje...":"Zakaži"}),(0,t.jsx)("button",{type:"button",onClick:e,className:"flex-1 rounded-lg bg-gray-100 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-200",children:"Otkaži"})]})]})]})})}e.s(["default",()=>r])},62048,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let s=["Ned","Pon","Uto","Sre","Čet","Pet","Sub"],r=["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Avg","Sep","Okt","Nov","Dec"];function n(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${s}`}function l({selectedDate:e,onSelect:a}){let l=new Date,i=new Date(e+"T00:00:00"),d=Math.max(0,Math.floor((i.getTime()-l.getTime())/864e5)-3),o=[];for(let e=0;e<7;e++){let t=new Date(l);t.setDate(l.getDate()+d+e),o.push(t)}return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{let e=new Date(i);e.setDate(e.getDate()-1),e>=l&&a(n(e))},className:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto",children:o.map(l=>{let i,d=n(l),o=d===e,c=(i=new Date,l.getFullYear()===i.getFullYear()&&l.getMonth()===i.getMonth()&&l.getDate()===i.getDate());return(0,t.jsxs)("button",{onClick:()=>a(d),className:`flex min-w-[4.5rem] flex-col items-center rounded-xl px-3 py-2 text-sm transition-all ${o?"bg-brand-500 text-white shadow-md":c?"border-2 border-brand-500 bg-white text-brand-600":"bg-white text-gray-600 hover:bg-gray-50"}`,children:[(0,t.jsx)("span",{className:"text-xs font-medium",children:s[l.getDay()]}),(0,t.jsx)("span",{className:"text-lg font-bold",children:l.getDate()}),(0,t.jsx)("span",{className:"text-xs",children:r[l.getMonth()]})]},d)})}),(0,t.jsx)("button",{onClick:()=>{let e=new Date(i);e.setDate(e.getDate()+1),a(n(e))},className:"rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})}let i={confirmed:"bg-brand-500 border-brand-600 text-white",completed:"bg-green-500 border-green-600 text-white"};function d({booking:e,rowHeight:a,onClick:s}){let r,n=function(e,t){let[a,s]=e.split(":").map(Number),[r,n]=t.split(":").map(Number);return Math.max(Math.round((60*r+n-(60*a+s))/30),1)}(e.startTime,e.endTime);try{let t=JSON.parse(e.services),a={mali:"Mali servis",veliki:"Veliki servis",kondenzator:"Kondenzator",ostalo:"Ostalo"};r=t.map(e=>a[e]||e).join(", ")}catch{r=e.services}return(0,t.jsxs)("div",{onClick:e=>{e.stopPropagation(),s?.()},className:`absolute inset-x-1 top-0 cursor-pointer overflow-hidden rounded-lg border px-2 py-1 text-xs shadow-sm transition-opacity hover:opacity-90 ${i[e.status]||i.confirmed}`,style:{height:`${n*a}px`,zIndex:10},children:[(0,t.jsx)("div",{className:"font-semibold truncate",children:e.customerName}),(0,t.jsx)("div",{className:"truncate opacity-80",children:r}),(0,t.jsxs)("div",{className:"opacity-80",children:[e.startTime," - ",e.endTime]})]})}let o=[];for(let e=7;e<22;e++)o.push(`${String(e).padStart(2,"0")}:00`),o.push(`${String(e).padStart(2,"0")}:30`);function c({date:e,onCellClick:s}){let[r,n]=(0,a.useState)([]),[l,i]=(0,a.useState)([]),[c,m]=(0,a.useState)(!0),[u,x]=(0,a.useState)(null),[g,b]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),[j,f]=(0,a.useState)(""),[y,v]=(0,a.useState)(!1),N=(0,a.useCallback)(()=>{m(!0),fetch(`/api/admin/schedule?date=${e}`).then(e=>e.json()).then(e=>{n(e.servisers||[]),i(e.bookings||[])}).finally(()=>m(!1))},[e]);(0,a.useEffect)(()=>{N()},[N]);let k=async()=>{u&&(v(!0),await fetch(`/api/admin/bookings/${u.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerName:g,customerPhone:h,customerAddress:j})}),v(!1),x(null),N())},w=async()=>{u&&(await fetch(`/api/admin/bookings/${u.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled"})}),x(null),N())};return c?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-brand-200 border-t-brand-500"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"overflow-x-auto rounded-xl border border-gray-200 bg-white",children:(0,t.jsxs)("table",{className:"w-full min-w-[600px]",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-gray-200 bg-gray-50",children:[(0,t.jsx)("th",{className:"w-20 px-3 py-2 text-left text-xs font-medium text-gray-500",children:"Vreme"}),r.map(e=>(0,t.jsxs)("th",{className:"px-3 py-2 text-center text-xs font-medium text-gray-500",children:[e.firstName," ",e.lastName]},e.id))]})}),(0,t.jsx)("tbody",{children:o.map((e,a)=>(0,t.jsxs)("tr",{className:`border-b border-gray-100 ${a%2==0?"bg-white":"bg-gray-50/50"}`,children:[(0,t.jsx)("td",{className:"px-3 text-xs text-gray-500 whitespace-nowrap",style:{height:"40px"},children:e}),r.map(a=>{let r=l.filter(t=>t.userId===a.id&&t.startTime===e);return(0,t.jsx)("td",{className:"relative cursor-pointer px-1",style:{height:"40px"},onClick:()=>0===r.length&&s?.(a.id,e),children:r.map(e=>(0,t.jsx)(d,{booking:e,rowHeight:40,onClick:()=>{x(e),b(e.customerName),p(e.customerPhone),f(e.customerAddress)}},e.id))},a.id)})]},e))})]})}),u&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl",children:[(0,t.jsx)("h3",{className:"mb-4 text-lg font-bold text-gray-900",children:"Detalji zakazivanja"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 space-y-1 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Usluge:"}),(0,t.jsx)("span",{className:"font-medium",children:(e=>{try{let t=JSON.parse(e),a={mali:"Mali servis",veliki:"Veliki servis",kondenzator:"Kondenzator",ostalo:"Ostalo"};return t.map(e=>a[e]||e).join(", ")}catch{return e}})(u.services)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Vreme:"}),(0,t.jsxs)("span",{className:"font-medium",children:[u.startTime," - ",u.endTime]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Trajanje:"}),(0,t.jsxs)("span",{className:"font-medium",children:[u.duration," min"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Status:"}),(0,t.jsx)("span",{className:`font-medium ${"confirmed"===u.status?"text-brand-600":"text-green-600"}`,children:"confirmed"===u.status?"Potvrđeno":"Završeno"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Ime i prezime"}),(0,t.jsx)("input",{type:"text",value:g,onChange:e=>b(e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Telefon"}),(0,t.jsx)("input",{type:"tel",value:h,onChange:e=>p(e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Adresa"}),(0,t.jsx)("input",{type:"text",value:j,onChange:e=>f(e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-900 outline-none focus:border-brand-500"})]})]}),(0,t.jsxs)("div",{className:"mt-5 flex gap-2",children:[(0,t.jsx)("button",{onClick:k,disabled:y,className:"flex-1 rounded-lg bg-brand-500 py-2.5 text-sm font-semibold text-white hover:bg-brand-600 disabled:bg-gray-300",children:y?"Čuvanje...":"Sačuvaj"}),"confirmed"===u.status&&(0,t.jsx)("button",{onClick:w,className:"flex-1 rounded-lg bg-red-500 py-2.5 text-sm font-semibold text-white hover:bg-red-600",children:"Otkaži termin"}),(0,t.jsx)("button",{onClick:()=>x(null),className:"flex-1 rounded-lg bg-gray-100 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-200",children:"Zatvori"})]})]})})]})}var m=e.i(12172);function u(){let e,s,r,n,[i,d]=(0,a.useState)((s=(e=new Date).getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),`${s}-${r}-${n}`)),[o,u]=(0,a.useState)(!1),[x,g]=(0,a.useState)({}),[b,h]=(0,a.useState)(0);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Raspored"}),(0,t.jsx)("button",{onClick:()=>{g({}),u(!0)},className:"rounded-lg bg-brand-500 px-4 py-2 text-sm font-semibold text-white hover:bg-brand-600",children:"+ Novo zakazivanje"})]}),(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(l,{selectedDate:i,onSelect:d})}),(0,t.jsx)(c,{date:i,onCellClick:(e,t)=>{g({serviserId:e,time:t}),u(!0)}},`${i}-${b}`),o&&(0,t.jsx)(m.default,{onClose:()=>u(!1),onCreated:()=>{u(!1),g({}),h(e=>e+1)},prefillServiserId:x.serviserId,prefillDate:i,prefillTime:x.time})]})}e.s(["default",()=>u],62048)}]);