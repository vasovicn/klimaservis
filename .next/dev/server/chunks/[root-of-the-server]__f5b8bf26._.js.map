{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nikola/Desktop/klimaservis/src/lib/auth.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from \"jose\";\nimport { cookies } from \"next/headers\";\n\nconst COOKIE_NAME = \"admin_token\";\nconst EXPIRY = \"8h\";\n\nfunction getSecret() {\n  const secret = process.env.JWT_SECRET;\n  if (!secret) throw new Error(\"JWT_SECRET is not set\");\n  return new TextEncoder().encode(secret);\n}\n\nexport interface TokenPayload {\n  userId: string;\n  email: string;\n  role: string;\n}\n\nexport async function signToken(payload: TokenPayload): Promise<string> {\n  return new SignJWT(payload as unknown as Record<string, unknown>)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setExpirationTime(EXPIRY)\n    .setIssuedAt()\n    .sign(getSecret());\n}\n\nexport async function verifyToken(token: string): Promise<TokenPayload | null> {\n  try {\n    const { payload } = await jwtVerify(token, getSecret());\n    return payload as unknown as TokenPayload;\n  } catch {\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set(COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    path: \"/\",\n    maxAge: 8 * 60 * 60,\n  });\n}\n\nexport async function clearAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.set(COOKIE_NAME, \"\", {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    path: \"/\",\n    maxAge: 0,\n  });\n}\n\nexport async function getTokenFromCookies(): Promise<string | undefined> {\n  const cookieStore = await cookies();\n  return cookieStore.get(COOKIE_NAME)?.value;\n}\n\nexport async function getCurrentUser(): Promise<TokenPayload | null> {\n  const token = await getTokenFromCookies();\n  if (!token) return null;\n  return verifyToken(token);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,cAAc;AACpB,MAAM,SAAS;AAEf,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;IACrC,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAC7B,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAQO,eAAe,UAAU,OAAqB;IACnD,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,QAClB,WAAW,GACX,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,aAAa,OAAO;QAClC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ,IAAI,KAAK;IACnB;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,aAAa,IAAI;QAC/B,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,OAAO,YAAY,GAAG,CAAC,cAAc;AACvC;AAEO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,YAAY;AACrB"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nikola/Desktop/klimaservis/src/app/api/auth/logout/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { clearAuthCookie } from \"@/lib/auth\";\n\nexport async function POST() {\n  await clearAuthCookie();\n  return NextResponse.json({ ok: true });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,IAAA,uIAAe;IACrB,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;AACtC"}}]
}