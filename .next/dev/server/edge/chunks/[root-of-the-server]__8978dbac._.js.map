{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { jwtVerify } from \"jose\";\n\nfunction getSecret() {\n  const secret = process.env.JWT_SECRET;\n  if (!secret) throw new Error(\"JWT_SECRET is not set\");\n  return new TextEncoder().encode(secret);\n}\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // Allow login page and login API without auth\n  if (\n    pathname === \"/admin/login\" ||\n    pathname === \"/api/auth/login\"\n  ) {\n    return NextResponse.next();\n  }\n\n  const token = request.cookies.get(\"admin_token\")?.value;\n\n  if (!token) {\n    if (pathname.startsWith(\"/api/\")) {\n      return NextResponse.json({ error: \"Niste prijavljeni\" }, { status: 401 });\n    }\n    return NextResponse.redirect(new URL(\"/admin/login\", request.url));\n  }\n\n  try {\n    const { payload } = await jwtVerify(token, getSecret());\n    const role = payload.role as string;\n\n    // /admin/users requires admin role\n    if (\n      (pathname.startsWith(\"/admin/users\") ||\n        pathname.startsWith(\"/api/admin/users\")) &&\n      role !== \"admin\"\n    ) {\n      if (pathname.startsWith(\"/api/\")) {\n        return NextResponse.json({ error: \"Nemate pristup\" }, { status: 403 });\n      }\n      return NextResponse.redirect(new URL(\"/admin/schedule\", request.url));\n    }\n\n    // Pass user info via headers\n    const response = NextResponse.next();\n    response.headers.set(\"x-user-id\", payload.userId as string);\n    response.headers.set(\"x-user-role\", role);\n    response.headers.set(\"x-user-email\", payload.email as string);\n    return response;\n  } catch {\n    if (pathname.startsWith(\"/api/\")) {\n      return NextResponse.json({ error: \"Niste prijavljeni\" }, { status: 401 });\n    }\n    return NextResponse.redirect(new URL(\"/admin/login\", request.url));\n  }\n}\n\nexport const config = {\n  matcher: [\"/admin/:path*\", \"/api/admin/:path*\"],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEA,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;IACrC,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAC7B,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,8CAA8C;IAC9C,IACE,aAAa,kBACb,aAAa,mBACb;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;IAElD,IAAI,CAAC,OAAO;QACV,IAAI,SAAS,UAAU,CAAC,UAAU;YAChC,OAAO,gMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QACA,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;IAClE;IAEA,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,4KAAS,EAAC,OAAO;QAC3C,MAAM,OAAO,QAAQ,IAAI;QAEzB,mCAAmC;QACnC,IACE,CAAC,SAAS,UAAU,CAAC,mBACnB,SAAS,UAAU,CAAC,mBAAmB,KACzC,SAAS,SACT;YACA,IAAI,SAAS,UAAU,CAAC,UAAU;gBAChC,OAAO,gMAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAiB,GAAG;oBAAE,QAAQ;gBAAI;YACtE;YACA,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,mBAAmB,QAAQ,GAAG;QACrE;QAEA,6BAA6B;QAC7B,MAAM,WAAW,gMAAY,CAAC,IAAI;QAClC,SAAS,OAAO,CAAC,GAAG,CAAC,aAAa,QAAQ,MAAM;QAChD,SAAS,OAAO,CAAC,GAAG,CAAC,eAAe;QACpC,SAAS,OAAO,CAAC,GAAG,CAAC,gBAAgB,QAAQ,KAAK;QAClD,OAAO;IACT,EAAE,OAAM;QACN,IAAI,SAAS,UAAU,CAAC,UAAU;YAChC,OAAO,gMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QACA,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;IAClE;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAiB;KAAoB;AACjD"}}]
}